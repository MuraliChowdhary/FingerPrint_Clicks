
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loading Page</title>
  </head>
  <body>
    <script type="module">
      // Show redirect message after 2 seconds
      setTimeout(() => {
        const redirectText = document.getElementById("redirectText");
        redirectText.classList.add("show");
      }, 2000);

      import("https://fpjscdn.net/v3/eGhj85oLHfdY0b0SHhzC")
        .then((FingerprintJS) => {
          FingerprintJS.load()
            .then((fp) => fp.get())
            .then((result) => {
              const visitorId = result.visitorId;
              localStorage.setItem("visitorId", visitorId);

              console.log(visitorId)

              const urlParams = new URLSearchParams(window.location.search);
              const shortId = urlParams.get("shortId");
              console.log(visitorId);
              fetch("https://ipapi.co/json/")
                .then((response) => response.json())
                .then((locationData) => {
                  const city = locationData.city;
                  console.log(city);

                  fetch(
                    "https://pickandpartner-94sz.onrender.com/store-visitor-id",
                    {
                      method: "POST",
                      headers: { "Content-Type": "application/json" },
                      body: JSON.stringify({ visitorId, shortId, city }),
                    }
                  )
                    .then((response) => {
                      if (!response.ok) {
                        throw new Error("Failed to store visitor data.");
                      }
                      return response.json();
                    })
                    .then((data) => {
                      if (data.originalUrl) {
                        window.location.href = data.originalUrl;
                      } else {
                        console.error("Original URL not found in response.");
                      }
                    })
                    .catch((error) =>
                      console.error(
                        "Error storing visitor ID and location:",
                        error
                      )
                    );
                })
                .catch((error) =>
                  console.error("Error fetching location data:", error)
                );
            })
            .catch((error) =>
              console.error("Error loading FingerprintJS:", error)
            );
        })
        .catch((error) =>
          console.error("Error importing FingerprintJS:", error)
        );
    </script>
  </body>
</html>